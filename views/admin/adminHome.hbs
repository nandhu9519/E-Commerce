<script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js" integrity="sha256-bC3LCZCwKeehY6T4fFi9VfOU0gztUa+S4cnkIhVPZ5E=" crossorigin="anonymous"></script>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.js"></script>

<script>
  $(document).ready(function () {
    $('#allOrders').DataTable();
  });
</script>
<div class="">
  <div class="wrapper ">
    <div class="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top " id="navigation-example">
        <div class="container-fluid">
          <div class="navbar-wrapper">
            <a class="navbar-brand" href="">Dashboard</a>
          </div>
          <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index"
            aria-expanded="false" aria-label="Toggle navigation" data-target="#navigation-example">
            <span class="sr-only">Toggle navigation</span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
          </button>
          <div class="collapse navbar-collapse justify-content-end">

            <ul class="navbar-nav">
              <li class="nav-item dropdown">
                <a class="nav-link" href="javscript:void(0)" id="navbarDropdownMenuLink" data-toggle="dropdown"
                  aria-haspopup="true" aria-expanded="false">
                  <i class="material-icons">person</i>
                  <p class="d-lg-none d-md-block">
                    Some Actions
                  </p>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                  <a class="dropdown-item" href="/admin/logout">Logout</a>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- End Navbar -->
      <div class="content">
        <div class="container-fluid">

        
          <div class="row">
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6">
              <div class="card card-stats" style="height: 140px;">
                <div class="card-header card-header-warning card-header-icon">
                  <div class="card-icon">
                    <i class="material-icons">content_copy</i>
                  </div>
                  <p class="card-category">Total Order</p>
                  <h3 class="card-title">{{orderCount}}
                  </h3>
                </div>
                
              </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6">
              <div class="card card-stats" style="height: 140px;">
                <div class="card-header card-header-success card-header-icon">
                  <div class="card-icon">
                    <i class="fa fa-inr" aria-hidden="true"></i>
                  </div>
                  <p class="card-category">Revenue</p>
                  <h3 class="card-title">â‚¹ {{totalRevenue}}</h3>
                </div>        
              </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6">
              <div class="card card-stats" style="height: 140px;">
                <div class="card-header card-header-danger card-header-icon">
                  <div class="card-icon">
                    <i class="fa fa-copyright" aria-hidden="true"></i>

                  </div>
                  <p class="card-category">Total Brands In Sale</p>
                  <h3 class="card-title">{{totalBrands}}</h3>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6">
              <div class="card card-stats" style="height: 140px;">
                <div class="card-header card-header-info card-header-icon">
                  <div class="card-icon">
                    <i class="fa fa-cubes" aria-hidden="true"></i>

                  </div>
                  <p class="card-category">Total Product Stock</p>
                  <h3 class="card-title">{{totalStock}}</h3>
                </div>
              </div>
            </div>
          </div>

          
          <div class="row">
            
         <div class="col-lg-6 col-md-6">
              <div class="card">
                <div class="card-header card-header-primary">
                  <h4 class="card-title">Order Detials</h4>
             
                </div>
                <div class="card-body table-responsive">
                 <canvas id="myChart" width="300"  height="160"></canvas>
                </div>
              </div>
            </div>
          <div class="col-lg-6 col-md-6">
              <div class="card">
                <div class="card-header card-header-primary">
                  <h4 class="card-title">User Payment Preference</h4>
             
                </div>
                <div class="card-body table-responsive">
                 <canvas id="chart" style="width:100%;max-height:400px"></canvas>
                </div>
              </div>
            </div>
          </div>
          
          
      
          <div class="row">
            <div class="col-lg-6 col-md-6">
              <div class="card">
                <div class="card-header card-header-primary">
                  <h4 class="card-title">Recent Orders</h4>
                  <p class="card-category"></p>
                </div>
                <div class="card-body table-responsive">
                  
                  <table class="table table-hover tm-table-small tm-product-table" id="allOrders">
                    <thead>
                      <tr>
                        <th scope="col">SL NO</th>
                        <th scope="col">PLACED ON</th>
                        <th scope="col">ORDER ID</th>
                        <th scope="col">CONTACT</th>
                        <th scope="col">TOTAL <br>ORDER<br> AMOUNT</th>
                        <th scope="col"></th>
                      </tr>
                    </thead>
                    <tbody>
                      {{#each recentOrders}}
                      <tr>
                        <td>{{add @index '1'}}</td>
                        <td class="tm-product-name">{{this.date}}</td>
                        <td>{{ this._id }}</td>
                        <td> {{this.deliveryDetails.contact}}</td>
                        <td>{{ this.totalAmount}}</td>
                        <td>
                            <a href="/admin/productOrderStatus/{{this._id}}"><button
                            class=" btn btn-success" style="width: 150px;">VIEW PRODUCTS</button> </a>
                        </td>
                      </tr>
                      {{/each}}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="col-lg-6 col-md-6">
              <div class="card">
                <div class="card-header card-header-primary">
                  <h4 class="card-title">Low Stock Notiftication</h4>
                  <p class="card-category"></p>
                </div>
                <div class="card-body table-responsive">
                  <table class="table table-hover tm-table-small tm-product-table" id="allOrders">
                    <thead>
                      <tr>
                        <th scope="col">SL NO</th>
                        <th scope="col">PRODUCT ID</th>
                        <th scope="col">PRODUCT NAME</th>
                        <th scope="col">STOCK</th>
                      </tr>
                    </thead>
                    <tbody>
                      {{#each lowStock}}
                      <tr>
                        <td>{{add @index '1'}}</td>
                        <td class="tm-product-name">{{this._id}}</td>
                        <td>{{ this.name }}</td>
                        <td>
                          {{#if (lt this.stock 30)}}
                          <span style="color: red;">LOW STOCK<br>{{this.stock}} REMAINING</span>
                          {{/if}}
                          {{#if (gt this.stock 30)}}
                          <span style="color:orange;">STOCK CRITICAL<br>{{this.stock}} REMAINING</span>
                          {{/if}}
                        </td>
                      </tr>
                      {{/each}}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <script>
        const x = new Date().getFullYear();
        let date = document.getElementById('date');
        date.innerHTML = '&copy; ' + x + date.innerHTML;
      </script>
    </div>
  </div>
</div>

<script>
const ctx = document.getElementById('myChart').getContext('2d');
const myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ['totalorders','shipped orders','cancelledorders','delivered orders'],
        datasets: [{
            label: '# of Votes',
            data: [{{orderCount}}, {{shippedCount}}, {{cancelCount}}, {{deliveredCount}}],
            backgroundColor: [
                'rgba(30, 224, 4, 0.7)',
                'rgba(224, 4, 173, 0.7)',
                'rgba(29, 23, 209, 0.7)',
                'rgba(207, 24, 21, 0.7)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(30, 224, 4, 1)',
                'rgba(224, 4, 173, 1)',
                'rgba(29, 23, 209, 1)',
                'rgba(207, 24, 21, 1)',
                'rgba(153, 102, 255, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>
<script>
var xValues = ["COD", "RazorPay", "Paypal"];
var yValues = [{{paymentModeCount.cod}},{{paymentModeCount.razorpay}},{{paymentModeCount.paypal}}];
var barColors = [
  "#1EE004",
  "#00aba9",
  "#2b5797",
  "#e8c3b9",
  "#1e7145"
];

new Chart("chart", {
  type: "doughnut",
  data: {
    labels: xValues,
    datasets: [{
      backgroundColor: barColors,
      data: yValues
    }]
  },
  options: {
    title: {
      display: true,
      text: "World Wide Wine Production 2018"
    }
  }
});
</script>